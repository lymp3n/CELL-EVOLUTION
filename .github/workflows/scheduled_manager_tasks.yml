name: "üìÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä—Å–∫–∏—Ö –∑–∞–¥–∞—á"
on:
  schedule:
    # –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 9:00 UTC (12:00 –ú–°–ö) - –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ø—Ä–∏–Ω—Ç–∞
    - cron: '0 9 * * 1'
  workflow_dispatch:  # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é

jobs:
  create-manager-tasks:
    runs-on: ubuntu-latest
    steps:
      - name: üõéÔ∏è Check out repository
        uses: actions/checkout@v3

      - name: üöÄ Setup GitHub CLI
        run: |
          type -p curl >/dev/null || (sudo apt update && sudo apt install curl -y)
          curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
          sudo chmod go+r /usr/share/keyrings/githubcli-archive-keyring.gpg
          echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null
          sudo apt update
          sudo apt install gh -y

      - name: üîë Authenticate with GitHub CLI
        run: echo "${{ secrets.GITHUB_TOKEN }}" | gh auth login --with-token
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: üìã Create Sprint Planning Task (–µ—Å–ª–∏ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –Ω–∞—á–∞–ª–∞ —Å–ø—Ä–∏–Ω—Ç–∞)
        run: |
          # –ó–¥–µ—Å—å –º–æ–∂–µ—Ç –±—ã—Ç—å –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–æ–º–µ—Ä–∞ —Å–ø—Ä–∏–Ω—Ç–∞
          SPRINT_NUM=1  # –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ –≤—ã—á–∏—Å–ª—è—Ç—å
          python scripts/create_manager_task.py --auto --type sprint_planning --sprint $SPRINT_NUM
        continue-on-error: true

      - name: üìä Create Weekly Progress Report Task
        run: |
          python scripts/create_manager_task.py --auto --type progress_report --sprint "–ù–µ–¥–µ–ª—è $(date +%U)"
        continue-on-error: true
